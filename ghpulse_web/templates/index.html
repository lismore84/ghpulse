<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHPulse Êï∞ÊçÆÊü•ËØ¢Âπ≥Âè∞</title>
    
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    
    <!-- Ëá™ÂÆö‰πâÊ†∑Âºè -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="app">
        <el-container style="height: 100vh">
            <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
            <el-header>
                <div class="header-content">
                    <h1>üöÄ GHPulse Êï∞ÊçÆÊü•ËØ¢Âπ≥Âè∞</h1>
                    <div class="header-stats">
                        <el-tag type="success">‰∫ã‰ª∂: {% raw %}{{ formatNumber(stats.total_events) }}{% endraw %}</el-tag>
                        <el-tag type="primary">Áî®Êà∑: {% raw %}{{ formatNumber(stats.total_actors) }}{% endraw %}</el-tag>
                        <el-tag type="warning">‰ªìÂ∫ì: {% raw %}{{ formatNumber(stats.total_repos) }}{% endraw %}</el-tag>
                    </div>
                </div>
            </el-header>
            
            <el-container>
                <!-- Â∑¶‰æßËæπÊ†è -->
                <el-aside width="250px">
                    <el-menu
                        :default-active="activeTab"
                        @select="handleMenuSelect"
                    >
                        <el-sub-menu index="tables">
                            <template #title>
                                <el-icon><Grid /></el-icon>
                                <span>Êï∞ÊçÆË°® ({% raw %}{{ tables.length }}{% endraw %})</span>
                            </template>
                            <el-menu-item 
                                v-for="table in tables" 
                                :key="table.name"
                                :index="'table-' + table.name"
                            >
                                <el-icon><Document /></el-icon>
                                <span>{% raw %}{{ table.name }}{% endraw %}</span>
                            </el-menu-item>
                        </el-sub-menu>
                        
                        <el-menu-item index="query">
                            <el-icon><Search /></el-icon>
                            <span>Ëá™ÂÆö‰πâÊü•ËØ¢</span>
                        </el-menu-item>
                        
                        <el-menu-item index="trending">
                            <el-icon><TrendCharts /></el-icon>
                            <span>ÁÉ≠Èó®Ê¶úÂçï</span>
                        </el-menu-item>
                        
                        <el-menu-item index="stats">
                            <el-icon><DataAnalysis /></el-icon>
                            <span>ÁªüËÆ°ÂàÜÊûê</span>
                        </el-menu-item>
                    </el-menu>
                </el-aside>
                
                <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
                <el-main>
                    <!-- Ë°®Ê†ºËßÜÂõæ -->
                    <div v-if="activeView === 'table'" class="table-view">
                        <div class="view-header">
                            <h2>{% raw %}{{ currentTable }}{% endraw %}</h2>
                            <div class="table-actions">
                                <el-button @click="loadTableData" :loading="loading">
                                    <el-icon><Refresh /></el-icon>
                                    Âà∑Êñ∞
                                </el-button>
                                <el-button @click="exportData">
                                    <el-icon><Download /></el-icon>
                                    ÂØºÂá∫
                                </el-button>
                            </div>
                        </div>
                        
                        <el-table 
                            :data="tableData" 
                            stripe 
                            border 
                            v-loading="loading"
                            style="width: 100%"
                            max-height="calc(100vh - 250px)"
                        >
                            <el-table-column 
                                v-for="col in tableColumns" 
                                :key="col.field"
                                :prop="col.field"
                                :label="col.field"
                                :width="getColumnWidth(col.type)"
                                show-overflow-tooltip
                            />
                        </el-table>
                        
                        <el-pagination
                            v-if="pagination.total > 0"
                            class="pagination"
                            :current-page="pagination.page"
                            :page-size="pagination.page_size"
                            :total="pagination.total"
                            :page-sizes="[10, 20, 50, 100]"
                            layout="total, sizes, prev, pager, next, jumper"
                            @size-change="handleSizeChange"
                            @current-change="handlePageChange"
                        />
                    </div>
                    
                    <!-- Ëá™ÂÆö‰πâÊü•ËØ¢ËßÜÂõæ -->
                    <div v-if="activeView === 'query'" class="query-view">
                        <div class="view-header">
                            <h2>Ëá™ÂÆö‰πâSQLÊü•ËØ¢</h2>
                        </div>
                        
                        <div class="query-editor">
                            <el-input
                                v-model="customSQL"
                                type="textarea"
                                :rows="10"
                                placeholder="ËæìÂÖ•SQLÊü•ËØ¢ËØ≠Âè•Ôºà‰ªÖÊîØÊåÅSELECTÔºâ
Á§∫‰æãÔºö
SELECT * FROM events LIMIT 10;
SELECT COUNT(*) FROM actors WHERE total_events > 100;"
                            />
                            
                            <div class="query-actions">
                                <el-button type="primary" @click="executeQuery" :loading="loading">
                                    <el-icon><CaretRight /></el-icon>
                                    ÊâßË°åÊü•ËØ¢
                                </el-button>
                                <el-button @click="customSQL = ''">
                                    <el-icon><Delete /></el-icon>
                                    Ê∏ÖÁ©∫
                                </el-button>
                                <span v-if="queryResult.execution_time" class="execution-time">
                                    ÊâßË°åÊó∂Èó¥: {% raw %}{{ queryResult.execution_time }}{% endraw %}s
                                </span>
                            </div>
                        </div>
                        
                        <div v-if="queryResult.rows" class="query-result">
                            <el-alert 
                                :title="`Êü•ËØ¢ËøîÂõû ${queryResult.count} Ë°åÊï∞ÊçÆ`" 
                                type="success" 
                                :closable="false"
                            />
                            
                            <el-table 
                                :data="queryResult.rows" 
                                stripe 
                                border 
                                style="width: 100%; margin-top: 20px"
                                max-height="500px"
                            >
                                <el-table-column 
                                    v-for="col in queryResult.columns" 
                                    :key="col"
                                    :prop="col"
                                    :label="col"
                                    show-overflow-tooltip
                                />
                            </el-table>
                        </div>
                    </div>
                    
                    <!-- ÁÉ≠Èó®Ê¶úÂçïËßÜÂõæ -->
                    <div v-if="activeView === 'trending'" class="trending-view">
                        <div class="view-header">
                            <h2>ÁÉ≠Èó®Ê¶úÂçï</h2>
                        </div>
                        
                        <el-row :gutter="20">
                            <el-col :span="12">
                                <el-card>
                                    <template #header>
                                        <div class="card-header">
                                            <span>üî• ÁÉ≠Èó®‰ªìÂ∫ì Top 10</span>
                                            <el-button text @click="loadTrendingRepos">Âà∑Êñ∞</el-button>
                                        </div>
                                    </template>
                                    
                                    <el-table :data="trendingRepos" stripe>
                                        <el-table-column prop="rank_position" label="ÊéíÂêç" width="60" />
                                        <el-table-column prop="repo_name" label="‰ªìÂ∫ì" min-width="200" show-overflow-tooltip />
                                        <el-table-column prop="stars_7d" label="7Êó•‚≠ê" width="80" />
                                        <el-table-column prop="forks_7d" label="7Êó•Fork" width="90" />
                                        <el-table-column prop="prs_7d" label="7Êó•PR" width="80" />
                                        <el-table-column prop="score" label="ÊÄªÂæóÂàÜ" width="90" />
                                    </el-table>
                                </el-card>
                            </el-col>
                            
                            <el-col :span="12">
                                <el-card>
                                    <template #header>
                                        <div class="card-header">
                                            <span>üë®‚Äçüíª Ê¥ªË∑ÉÂºÄÂèëËÄÖ Top 10</span>
                                            <el-button text @click="loadTrendingDevelopers">Âà∑Êñ∞</el-button>
                                        </div>
                                    </template>
                                    
                                    <el-table :data="trendingDevelopers" stripe>
                                        <el-table-column prop="rank_position" label="ÊéíÂêç" width="60" />
                                        <el-table-column prop="actor_login" label="ÂºÄÂèëËÄÖ" min-width="150" show-overflow-tooltip />
                                        <el-table-column prop="commits_7d" label="7Êó•Êèê‰∫§" width="90" />
                                        <el-table-column prop="prs_7d" label="7Êó•PR" width="80" />
                                        <el-table-column prop="issues_7d" label="7Êó•Issue" width="90" />
                                        <el-table-column prop="activity_score" label="Ê¥ªË∑ÉÂ∫¶" width="90" />
                                    </el-table>
                                </el-card>
                            </el-col>
                        </el-row>
                    </div>
                    
                    <!-- ÁªüËÆ°ÂàÜÊûêËßÜÂõæ -->
                    <div v-if="activeView === 'stats'" class="stats-view">
                        <div class="view-header">
                            <h2>ÁªüËÆ°ÂàÜÊûê</h2>
                        </div>
                        
                        <el-row :gutter="20">
                            <el-col :span="6" v-for="(value, key) in stats" :key="key">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-label">{% raw %}{{ getStatLabel(key) }}{% endraw %}</div>
                                        <div class="stat-value">{% raw %}{{ formatStatValue(key, value) }}{% endraw %}</div>
                                    </div>
                                </el-card>
                            </el-col>
                        </el-row>
                        
                        <el-card style="margin-top: 20px">
                            <template #header>
                                <div class="card-header">
                                    <span>‰∫ã‰ª∂Á±ªÂûãÂàÜÂ∏É</span>
                                    <el-button text @click="loadEventTypeStats">Âà∑Êñ∞</el-button>
                                </div>
                            </template>
                            
                            <el-table :data="eventTypeStats" stripe v-loading="loading">
                                <!-- ‰øÆÊîπËøôÈáåÔºöÁ°Æ‰øù event_type ÂàóÊ≠£Á°ÆÊòæÁ§∫ -->
                                <el-table-column prop="event_type" label="‰∫ã‰ª∂Á±ªÂûã" width="200">
                                    <template #default="scope">
                                        <el-tag>{% raw %}{{ scope.row.event_type }}{% endraw %}</el-tag>
                                    </template>
                                </el-table-column>
                                
                                <el-table-column prop="count" label="Êï∞Èáè" width="150">
                                    <template #default="scope">
                                        {% raw %}{{ scope.row.count.toLocaleString() }}{% endraw %}
                                    </template>
                                </el-table-column>
                                
                                <el-table-column label="Âç†ÊØî">
                                    <template #default="scope">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <el-progress 
                                                :percentage="getPercentage(scope.row.count)" 
                                                :color="getProgressColor(scope.$index)"
                                                style="flex: 1;"
                                            />
                                            <span style="min-width: 60px; text-align: right;">
                                                {% raw %}{{ getPercentage(scope.row.count) }}{% endraw %}%
                                            </span>
                                        </div>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-card>
                    </div>
                </el-main>
            </el-container>
        </el-container>
    </div>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Element Plus -->
    <script src="https://unpkg.com/element-plus"></script>
    <!-- Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <!-- Â∫îÁî®ËÑöÊú¨ -->
    <script src="{{ url_for('static', filename='app.js') }}?v={{ range(1, 10000) | random }}"></script>
</body>
</html>